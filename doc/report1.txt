# used tec

## 制御ロジック／追従（Control）
・[角度クランプ] — 指令角を機械範囲（min–max）に収め安全性を担保。

・幾何・座標変換（Geometry）
[deg/px 変換（FOV幾何）] — deg_per_px = HFOV / 画素幅 で誤差pxを角度に換算。

・[レターボックス補正] — 推論のパディング座標を元画像座標へ戻して正確に制御。

・[三分割(×3)構図ターゲット] – LEFT/CENTER/RIGHT/AUTO の目標xを決め、pixel→yaw→servo に変換。フレーミングの意図に合わせて制御誤差を定義。 Rule‑of‑Thirds (Composition) Target

﻿
・﻿ [Rect2d統一] – OpenCVのトラッカAPI（CSRT/KCF）は Rect2d 前提。座標型を Rect2d に統一し、演算子（&= など）の型不一致と丸め誤差を防ぐ。画像サイズで必ずクリップし、w,h≥2 を保証。

## 画像処理・トラッキング（Vision）
・[track‑by‑detectionゲート(再アンカー)] – TRACK中もNフレームごとに検出を走らせ、IoUや中心距離でトラッカ結果を検証・再アンカー。ドリフトや誤追尾を低減。

・[前処理] – ROI（推奨）または全体に、ガンマ補正＋CLAHE(Lチャンネル)＋アンシャープを適用してコントラスト/ディテールを強調

・[線形補間] – 欠損時は1ステップ線形予測（直近速度）でつなぎ、因果ガウシアン移動平均で滑らかさを確保。window/σ/max_gap で調整。

## ハードウェア／シリアル（HW/Serial）
・[Telemetrix/Telemetrix4Arduino] — Arduino 側に汎用I/Oサーバ、ホストは Telemetrix で servo_write。

・[最小可動角・バックラッシュ実測] — 動き出し閾値と戻りガタを GUI で計測し設定に反映。

・[サーボ端点キャリブレーション] — µs 幅を実測で最適化し 0–180°へ安全マップ。
clamp 処理

=>工学的処理でdeeptrackPX4でも実装。

# ROS 2／実装アーキテクチャ（ROS/Arch）

・[MultiThreadedExecutor(4)] — 待機スレッドとコールバックを並列化しデッドロック回避

・[ACKハンドシェイク] — /inference 発行後に /px3_ack を待つロックステップ（早着即時復帰＋上限タイムアウト）。lock_guardの並列処理

・[QoS選定] — px3_ready は TRANSIENT_LOCAL、他は基本 Reliable/Depth=10 程度。QOSのラッチでpx2とpx3のノードを同時に始める。
 

# tried but fialed so unused tec (no effective)

・[スルーレート制限] — 角度の最大変化速度（°/s）を制限し、急峻な指令での振動や見失いを防ぐ。

・[加速度制限] — 角速度の変化（°/s²）を抑え、起動・停止を滑らかにする。

・[バンバン制御] — 誤差の符号で「左/停止/右」の三値だけを出す簡易安定制御。
参考medium  ：https://medium.com/@bramburggraaf/real-time-object-tracking-with-python-yolov5-and-arduino-servo-control-follow-person-or-pet-ef0da07849d8

・[非線形tanh＋スルー] — step = step_max * tanh(k*error) で大誤差は強く・小誤差は微小に。

・[atan2ベースのピクセル→角度] — Δx/Δy を焦点距離で割った arctan で非線形に角度化（端で±FOV/2へ収束）。

・[内部パラメータ／キャリブレーション] — fx, fy, cx, cy と歪み係数を求め、マッピングの整合性を確保。

・[FOV再推定] — 実測ケースから fx/fy を平均化して HFOV/VFOV を更新。

・[増分制御] — servo <- servo + step の形で小刻みに更新（上限付き）。飽和時の張り付き回避にも有効。

・[トラッカー併用（YOLO＋CSRT/KCF/MOSSE）] — 検出の合間を短期トラッカーで補完して中心安定。
https://broutonlab.com/blog/opencv-object-tracking/

・[状態機械（FSM）] — DETECT→TRACK↔CENTERED／LOST→SEEK といった明確な遷移で挙動を安定化。

# candidate for use

・[先読み制御（遅延補償）] — 誤差の変化傾向から先を外挿して追従遅れを補う。

・[デッドバンド] — 中心近傍の小誤差（±px/±deg）を無視してサーボのハンチングを抑える。

・[背景差分] — 動体抽出の前処理強化（MOG2/KNN）。

・[ジッター平滑] — 検出中心に EMA 等を適用してノイズ由来の揺れを抑える。

・[RANSAC／MAP推定] — 外れ値排除や確率的統合で頑健性を向上。

・[エンコーダ／IMU／電源] — 実角取得・外乱補正・電圧降下対策で安定化。

・[レンズ歪み補正] — undistort で幾何誤差を低減し px→deg 変換の精度を上げる。

・[coast＋スイープ探索] — 見失い時は慣性的に小パルス継続→それでもダメなら左右スイープで再捕捉。

・[GSI（二側平滑/補間）] – 未来側も使う非因果の後処理/固定ラグ平滑。欠損を前後の有効点で真の補間。リアルタイム制御より品質重視の仕上げ用（GGSを補完）

・[ブラーゲート(Laplacian分散)] – ROIのラプラシアン分散が閾値未満（＝ブレ/ボケ）なら update() を**スキップ（ホールド）**し、学習劣化と破綻を防ぐ。

# untouched

・[ヒステリシス] — IN/OUT の二つの閾値で中央判定を行い、境界付近のチラつきを防止。

・[固定角ステップ（段階切替）] — 誤差大なら大きめ、誤差小なら小さめの一定角ステップを使い分ける。

・[近遠段階化] — BBox面積の大小でステップ量を段階切替（遠い＝大、近い＝小）。

・[PID制御] — P/PI/PD を状況に応じて使い分け、安定かつ高速に収束。

・[特徴点マッチング] — 再検出・テンプレート追従の堅牢化（ORB/AKAZE/SIFT 等）。

